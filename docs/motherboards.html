<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mi899 - Explore Motherboards</title>
    <link href="libs/bootstrap.min.css" rel="stylesheet" />
    <link href="styles/mi899.css" rel="stylesheet" />
</head>
<body class="bg-body-tertiary">
    <script src="libs/bootstrap.bundle.min.js"></script>
    <script src="libs/knockout-min.js"></script>
    <div>
        <div class="mi899-template" href="nav.html">
            <div class="mi899-spinner">
                <div class="spinner-border" role="status"></div>
                <span>Loading...</span>
            </div>
        </div>
        <section>
            <form class="form-floating">
                <select class="form-select" data-bind="options: brands, selectedOptions: selectedBrands" id="ddlBrand"></select>
                <label for="ddlBrand">Explore motherboards by brand</label>
            </form>
        </section>
        <section>
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th class="mi899-img-motherboard-thumbnail"></th>
                        <th>Name</th>
                        <th>Version</th>
                        <th>Description</th>
                        <th>Tags</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: selectedMotherboards">
                    <tr>
                        <td class="mi899-img-motherboard-thumbnail">
                            <img class="img-thumbnail mi899-img-motherboard-thumbnail" data-bind="attr: { src: document.Mi899.dataRepositoryUrl + Images[0]?.Url }" />
                        </td>
                        <td>
                            <a data-bind="text: Name, attr: { href: 'motherboard.html?m=' + $data.Id }"></a>
                        </td>
                        <td data-bind="text: $data?.Version"></td>
                        <td data-bind="text: $data?.Description"></td>
                        <td data-bind="foreach: $data?.Tags">
                            <span class="badge text-bg-secondary" data-bind="text: $data"></span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
    </div>
    <div class="mi899-template" href="footer.html">
        <div class="mi899-spinner">
            <div class="spinner-border" role="status"></div>
            <span>Loading...</span>
        </div>
    </div>
    <script src="scripts/mi899.js"></script>
    <script>
        const ViewModel = function () {
            this.brands = ko.observableArray([]);
            this.motherboards = ko.observableArray([]);
            this.selectedBrands = ko.observableArray([]);
            this.selectedMotherboards = ko.pureComputed(() => {
                const brand = this.selectedBrands()[0];
                return this.motherboards().filter(x => x.Brand == brand);
            });
        };

        const viewModel = new ViewModel();

        ko.applyBindings(viewModel);

        fetch(document.Mi899.modelUrl)
            .then(r => r.json())
            .then(model => {
                const brands = [... new Set(model.Motherboards.map(x => x.Brand))];

                brands.sort();
                viewModel.brands(brands);
                viewModel.selectedBrands(["Machinist"]);

                viewModel.motherboards(model.Motherboards);
            });
    </script>
</body>
</html>